<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.imooc.mapper.ItemsCommentsMapperCustom" >

  <insert id="saveComments" parameterType="map">
    insert into
        items_comments
        (
          id,
          user_id,
          item_id,
          item_name,
          item_spec_id,
          sepc_name,
          comment_level,
          content,
          created_time,
          updated_time
        )
    values
        <foreach collection="paramMap.orderItemsComments" item="item" separator="," index="index">
          (
            #{item.commentId},
            #{paramMap.userId},
            #{item.itemId},
            #{item.itemName},
            #{item.itemSpecId},
            #{item.itemSpecName},
            #{item.commentLevel},
            #{item.content},
            now(),
            now()
          )
        </foreach>
  </insert>

  <resultMap id="myComment" type="com.imooc.vo.MyCommentVO" >
      <id property="commentId" column="commentId"/>
    <result property="content" column="content"/>
    <result property="createdTime" column="createdTime"/>
    <result property="itemId" column="itemId"/>
    <result property="itemName" column="itemName"/>
    <result property="specName" column="specName"/>
    <result property="itemImg" column="itemImg"/>
  </resultMap>

  <select id="queryMyComments" parameterType="string" resultMap="myComment">
    SELECT
      ic.id AS commentId,
      ic.content AS content,
      ic.created_time AS createdTime,
      ic.item_id AS itemId,
      ic.item_name AS itemName,
      ic.sepc_name AS specName,
      ii.url AS itemImg
  FROM
      items_comments ic
      LEFT JOIN items_img ii ON ic.item_id = ii.item_id
  WHERE
      ic.user_id = #{userId}
      AND ii.is_main = 1
  ORDER BY
      ic.created_time DESC


  </select>

</mapper>